(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{120:function(e,t,a){e.exports=a(211)},125:function(e,t,a){},126:function(e,t,a){},176:function(e,t){},200:function(e,t){},202:function(e,t){},210:function(e,t,a){},211:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(9),o=a.n(c),l=(a(125),a(126),a(23)),u=a.n(l),s=a(34),i=a(35),m=a(6),p=a(14),d=a(250),f=a(254),b=a(109),g=a.n(b),E=a(251),v=a(252),O=a(253),h=a(248),j=a(245),y=a(12),N=a(22),S=function(e){return console.log("ACTION_CREATOR_LOGIN",e),{type:"REGISTRATION",payload:Object(m.a)(Object(m.a)({},e),{},{isAuth:!0})}},I=function(e){return{type:"LOGIN",payload:Object(m.a)(Object(m.a)({},e),{},{isAuth:!0})}},w=function(e){return{type:"IS_ME",payload:{nameOfUser:e}}},x=Object(j.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1),fontSize:20},submit:{margin:e.spacing(3,0,2)}}})),k=function(e){var t=e.title,a=e.isReg,c=x(),o=Object(y.g)(),l=Object(n.useState)({}),b=Object(p.a)(l,2),j=b[0],k=b[1],T=Object(n.useState)(!1),M=Object(p.a)(T,2),R=(M[0],M[1]),D=Object(N.b)();function A(e){var t=e.target,a=t.value,n=t.name;k(Object(m.a)(Object(m.a)({},j),{},Object(i.a)({},n,a)))}function C(){return(C=Object(s.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log(j),e.prev=2,e.next=5,fetch("http://localhost:3006/user/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});case 5:return a=e.sent,e.next=8,a.json();case 8:n=e.sent,a.ok?(D(I(n)),D(w(n.name))):(console.log(n.message),R(!0)),k({email:"",password:""}),o.push("/profile"),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function _(){return(_=Object(s.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log(j),e.prev=2,e.next=5,fetch("http://localhost:3006/user/registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});case 5:return a=e.sent,e.next=8,a.json();case 8:n=e.sent,a.ok?(D(S(n)),D(w(n.name))):(console.log(n.message),R(!0)),k({name:"",email:"",password:""}),o.push("/profile"),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}return r.a.createElement(h.a,{component:"main",maxWidth:"xs"},r.a.createElement(d.a,null),r.a.createElement("div",{className:c.paper},r.a.createElement(f.a,{className:c.avatar},r.a.createElement(g.a,null)),r.a.createElement(E.a,{component:"h1",variant:"h5"},t),r.a.createElement("form",{onSubmit:a?function(e){return _.apply(this,arguments)}:function(e){return C.apply(this,arguments)},className:c.form,noValidate:!0},a&&r.a.createElement(v.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"name",label:"Name",type:"name",id:"name",autoComplete:"current-password",onChange:A,autoFocus:!0}),r.a.createElement(v.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",onChange:A}),r.a.createElement(v.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",onChange:A}),r.a.createElement(O.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:c.submit},t))))},T=function(){return r.a.createElement(k,{title:"Sign Up",isReg:!0})};var M=function(){return r.a.createElement(k,{title:"Sign in"})},R=a(114);var D=function(e){var t=e.children,a=Object(R.a)(e,["children"]),n=Object(N.c)((function(e){return e.aboutMe}));return console.log(n),r.a.createElement(y.b,Object.assign({},a,{render:function(e){var a=e.location;return n.isMe?t:r.a.createElement(y.a,{to:{pathname:"/user/login",state:{from:a}}})}}))},A=a(58),C=a.n(A),_=a(59),G=a.n(_),W=G()(),J=a(60),U=function(e,t){switch(t.type){case"JOINED":return Object(m.a)(Object(m.a)({},e),{},{joined:!0,userName:t.payload.userName,roomId:t.payload.roomId});case"SET_DATA":return Object(m.a)(Object(m.a)({},e),{},{users:t.payload.users,messages:t.payload.messages});case"SET_USERS":return Object(m.a)(Object(m.a)({},e),{},{users:t.payload});case"NEW_MESSAGE":return Object(m.a)(Object(m.a)({},e),{},{messages:[].concat(Object(J.a)(e.messages),[t.payload])});default:return e}};var L=function(e){var t=e.onLogin,a=r.a.useState(""),n=Object(p.a)(a,2),c=n[0],o=n[1],l=r.a.useState(""),i=Object(p.a)(l,2),m=i[0],d=i[1],f=r.a.useState(!1),b=Object(p.a)(f,2),g=b[0],E=b[1],v=function(){var e=Object(s.a)(u.a.mark((function e(){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c&&m){e.next=2;break}return e.abrupt("return",alert("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"));case 2:return a={roomId:c,userName:m},E(!0),e.next=6,C.a.post("/rooms",a);case 6:t(a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"join-block"},r.a.createElement("input",{type:"text",placeholder:"\u041d\u043e\u043c\u0435\u0440 \u043a\u043e\u043c\u043d\u0430\u0442\u044b",value:c,onChange:function(e){return o(e.target.value)}}),r.a.createElement("input",{type:"text",placeholder:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",value:m,onChange:function(e){return d(e.target.value)}}),r.a.createElement("button",{disabled:g,onClick:v,className:"btn btn-success"},g?"\u0412\u0425\u041e\u0414...":"\u0412\u041e\u0419\u0422\u0418"))};var P=function(e){var t=e.users,a=e.messages,n=e.userName,c=e.roomId,o=e.onAddMessage,l=r.a.useState(""),u=Object(p.a)(l,2),s=u[0],i=u[1],m=r.a.useRef(null);return r.a.useEffect((function(){m.current.scrollTo(0,99999)}),[a]),r.a.createElement("div",{className:"chat"},r.a.createElement("div",{className:"chat-users"},"\u041a\u043e\u043c\u043d\u0430\u0442\u0430: ",r.a.createElement("b",null,c),r.a.createElement("hr",null),r.a.createElement("b",null,"\u041e\u043d\u043b\u0430\u0439\u043d (",t.length,"):"),r.a.createElement("ul",null,t.map((function(e,t){return r.a.createElement("li",{key:e+t},e)})))),r.a.createElement("div",{className:"chat-messages"},r.a.createElement("div",{ref:m,className:"messages"},a.map((function(e){return r.a.createElement("div",{className:"message"},r.a.createElement("p",null,e.text),r.a.createElement("div",null,r.a.createElement("span",null,e.userName)))}))),r.a.createElement("form",null,r.a.createElement("textarea",{value:s,onChange:function(e){return i(e.target.value)},className:"form-control",rows:"3"}),r.a.createElement("button",{onClick:function(){W.emit("ROOM:NEW_MESSAGE",{userName:n,roomId:c,text:s}),o({userName:n,text:s}),i("")},type:"button",className:"btn btn-primary"},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"))))};var V=function(){var e=r.a.useReducer(U,{joined:!1,roomId:null,userName:null,users:[],messages:[]}),t=Object(p.a)(e,2),a=t[0],n=t[1],c=function(){var e=Object(s.a)(u.a.mark((function e(t){var a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n({type:"JOINED",payload:t}),W.emit("ROOM:JOIN",t),e.next=4,C.a.get("/rooms/".concat(t.roomId));case 4:a=e.sent,r=a.data,n({type:"SET_DATA",payload:r});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(e){n({type:"SET_USERS",payload:e})},l=function(e){n({type:"NEW_MESSAGE",payload:e})};return r.a.useEffect((function(){W.on("ROOM:SET_USERS",o),W.on("ROOM:NEW_MESSAGE",l)}),[]),window.socket=W,r.a.createElement("div",{className:"wrapper"},a.joined?r.a.createElement(P,Object.assign({},a,{onAddMessage:l})):r.a.createElement(L,{onLogin:c}))},q=a(69),F=a(70),z=a.n(F),B=a(71);function H(){var e=Object(q.a)(["\n    height: 40%;\n    width: 50%;\n"]);return H=function(){return e},e}function K(){var e=Object(q.a)(["\n    padding: 20px;\n    display: flex;\n    height: 100vh;\n    width: 90%;\n    margin: auto;\n    flex-wrap: wrap;\n"]);return K=function(){return e},e}var Q=B.a.div(K()),X=B.a.video(H()),Y=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){e.peer.on("stream",(function(e){t.current.srcObject=e}))}),[]),r.a.createElement(X,{playsInline:!0,autoPlay:!0,ref:t})},Z={height:window.innerHeight/2,width:window.innerWidth/2},$=function(e){var t=Object(n.useState)([]),a=Object(p.a)(t,2),c=a[0],o=a[1],l=Object(n.useRef)(),u=Object(n.useRef)(),s=Object(n.useRef)([]),i=e.match.params.roomID,m=Object(n.useRef)(),d=Object(n.useState)(!0),f=Object(p.a)(d,2),b=f[0],g=f[1],E=Object(n.useState)(!1),v=Object(p.a)(E,2),O=v[0],h=v[1];return Object(n.useEffect)((function(){l.current=G.a.connect("/"),navigator.mediaDevices.getUserMedia({video:Z,audio:!0}).then((function(e){u.current.srcObject=e,m.current=e,m.current.getAudioTracks()[0].enabled=O,l.current.emit("join room",i),l.current.on("all users",(function(t){var a=[];t.forEach((function(t){var n=function(e,t,a){var n=new z.a({initiator:!0,trickle:!1,stream:a});return n.on("signal",(function(a){l.current.emit("sending signal",{userToSignal:e,callerID:t,signal:a})})),n}(t,l.current.id,e);s.current.push({peerID:t,peer:n}),a.push({peerID:t,peer:n})})),o(a)})),l.current.on("user joined",(function(t){console.log("user join");var a=function(e,t,a){console.log("add user");var n=new z.a({initiator:!1,trickle:!1,stream:a});return n.on("signal",(function(e){l.current.emit("returning signal",{signal:e,callerID:t})})),n.signal(e),n}(t.signal,t.callerID,e);s.current.push({peerID:t.callerID,peer:a});var n={peer:a,peerID:t.callerID};o((function(e){return[].concat(Object(J.a)(e),[n])}))})),l.current.on("receiving returned signal",(function(e){s.current.find((function(t){return t.peerID===e.id})).peer.signal(e.signal)})),l.current.on("user left",(function(e){var t=s.current.find((function(t){return t.peerID===e}));t&&t.peer.destroy();var a=s.current.filter((function(t){return t.peerID!==e}));s.current=a,o(a)}))}))}),[]),Object(n.useEffect)((function(){m.current&&m.current.getVideoTracks()[0]&&m.current.getVideoTracks()[0].enabled!==b&&(m.current.getVideoTracks()[0].enabled=b),m.current&&m.current.getAudioTracks()[0]&&m.current.getAudioTracks()[0].enabled!==O&&(m.current.getAudioTracks()[0].enabled=O)}),[b,O]),r.a.createElement(Q,null,console.log("Render comp"),r.a.createElement(X,{muted:!0,ref:u,autoPlay:!0,playsInline:!0}),r.a.createElement("button",{onClick:function(){return h((function(e){return!e}))}},"Micro"),r.a.createElement("button",{onClick:function(){return g((function(e){return!e}))}},"Video"),c.map((function(e){return r.a.createElement(Y,{key:e.peerID,peer:e.peer})})))},ee=function(){return r.a.createElement("div",{className:"profile__page"},r.a.createElement("button",{type:"button"},"\u0412\u044b\u0439\u0442\u0438"))},te=(a(210),a(21)),ae=function(){var e=Object(N.c)((function(e){return e.aboutMe}));console.log(e);var t=Object(N.b)();Object(y.g)();return r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"navbar"},r.a.createElement("div",{className:"navbar-nav ml-auto"},e.isMyName?r.a.createElement("div",{className:"nav-item "},r.a.createElement(te.b,{to:"/user/registration",className:"nav-link",onClick:function(){var a;t((a=e.isMyName,console.log(a,"userdata"),{type:"LOGOUT",payload:{name:a}})),t({type:"IS_NOT_ME",payload:{}}),localStorage.clear()}},"\u0412\u044b\u0439\u0442\u0438")):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"nav-item"},r.a.createElement(te.b,{className:"nav-link",to:"/user/registration"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")),r.a.createElement("div",{className:"nav-item"},r.a.createElement(te.b,{className:"nav-link",to:"/user/login"},"\u0412\u043e\u0439\u0442\u0438"))),r.a.createElement("div",{className:"nav-item"},r.a.createElement(te.b,{className:"nav-link",to:"/videochat"},"video")),r.a.createElement("div",{className:"nav-item"},r.a.createElement(te.b,{className:"nav-link",to:"/signin"},"chat")))))};var ne=function(){var e=Object(N.c)((function(e){return e.aboutMe}));return console.log(e),r.a.createElement("div",{className:"App"},r.a.createElement(ae,null),r.a.createElement(y.d,null,r.a.createElement(y.b,{exact:!0,path:"/user/registration"},r.a.createElement(T,null)),r.a.createElement(y.b,{exact:!0,path:"/user/login"},r.a.createElement(M,null)),r.a.createElement(y.b,{exact:!0,path:"/videochat",component:$}),r.a.createElement(y.b,{exact:!0,path:"/profile"},r.a.createElement(D,{exact:!0,path:"/profile"},r.a.createElement(ee,null))),r.a.createElement(y.b,{exact:!0,path:"/"},e.isMe?r.a.createElement(y.a,{to:"/profile"}):r.a.createElement(y.a,{to:"/user/registration"})),r.a.createElement(y.b,{exact:!0,path:"/signin"},r.a.createElement(V,null))))},re=a(32),ce=function(){return JSON.parse(localStorage.getItem("redux"))||{aboutMe:{},users:{}}},oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REGISTRATION":case"LOGIN":return Object(m.a)(Object(m.a)({},e),{},Object(i.a)({},t.payload.name,t.payload));case"LOGOUT":return delete e[t.payload.name],Object(m.a)({},e);default:return e}},le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IS_ME":return Object(m.a)(Object(m.a)({},e),{},{isMe:!0,isMyName:t.payload.nameOfUser});case"IS_NOT_ME":return Object(m.a)(Object(m.a)({},e),{},{isMe:!1,isMyName:""});default:return e}},ue=Object(re.combineReducers)({users:oe,aboutMe:le}),se=a(113),ie=Object(se.composeWithDevTools)(),me=Object(re.createStore)(ue,ce(),ie);me.subscribe((function(){localStorage.setItem("redux",JSON.stringify(me.getState()))}));var pe=me;o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(N.a,{store:pe},r.a.createElement(te.a,null,r.a.createElement(ne,null)))),document.getElementById("root"))}},[[120,1,2]]]);
//# sourceMappingURL=main.a593f088.chunk.js.map